<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.KG.mybatis.myMapper">

	<!-- 관리자 페이지 : 답변별 문의글 목록 조회 -->
	<select id="selectCustomerList" parameterType="hashmap" resultType="customerDTO">
		SELECT B.* FROM (
			SELECT ROWNUM cus_rn, A.* FROM
				(SELECT * FROM customer ORDER BY cus_num DESC, cus_date ASC)A 
			WHERE cus_categoryNum = #{cus_categoryNum} )B 
		WHERE cus_rn BETWEEN #{start} and #{end}
	</select>

	<!-- 관리자 페이지 : 답변별 문의글 개수 -->
	<select id="selectCustomerCount" resultType="int">
		SELECT COUNT(*) FROM customer WHERE cus_categoryNum = #{cus_categoryNum}
	</select>

	<!-- 회원 페이지 : 전체 문의글 목록 조회 -->
	<select id="AllCustomerList" parameterType="hashmap" resultType="customerDTO">
		SELECT B.* FROM (
			SELECT ROWNUM cus_rn, A.* FROM
				(SELECT * FROM customer ORDER BY cus_num DESC, cus_date ASC)A )B 
		WHERE cus_rn BETWEEN #{start} and #{end}
	</select>

	<!-- 회원 페이지 : 전체 문의글 개수 -->
	<select id="AllCustomerCount" resultType="int">
		SELECT COUNT(*) FROM customer
	</select>

	<!-- 회원 페이지 : 문의 접수 -->
	<insert id="insertInquiry" parameterType="customerDTO">
		<choose>
			<when test="cus_pw eq '' and cus_pw eq null">
				INSERT INTO customer (cus_num, cus_reNum, cus_categoryNum, cus_category, cus_nick, cus_id, cus_title, cus_email, cus_content, cus_date)
				VALUES (cus_numSQ.nextval, 0, #{cus_categoryNum}, #{cus_category}, #{cus_nick}, #{cus_id}, #{cus_title}, #{cus_email}, #{cus_content}, SYSDATE)
			</when>
			<otherwise>
				INSERT INTO customer (cus_num, cus_reNum, cus_categoryNum, cus_category, cus_nick, cus_id, cus_pw, cus_title, cus_email, cus_content, cus_date)
				VALUES (cus_numSQ.nextval, 0, #{cus_categoryNum}, #{cus_category}, #{cus_nick}, #{cus_id}, #{cus_pw}, #{cus_title}, #{cus_email}, #{cus_content}, SYSDATE)
			</otherwise>
		</choose>
	</insert>

	<!-- 회원 페이지 : 문의 페이지 출력 -->
	<select id="selectInquiryContent" resultType="customerDTO">
		SELECT * FROM customer WHERE cus_num = #{cus_num}
	</select>

	<!-- 회원 페이지 : 회원별 문의 내역 목록 조회(아이디 조회) -->
	<select id="selectInquiry" parameterType="hashmap" resultType="customerDTO">
		SELECT B.* FROM (
			SELECT ROWNUM cus_rn, A.* FROM
				(SELECT * FROM customer ORDER BY cus_num DESC, cus_date ASC)A
			WHERE cus_id = #{cus_id} )B 
		WHERE cus_rn BETWEEN #{start} and #{end}
	</select>

	<!-- 회원 페이지 : 회원별 문의 내역 개수 -->
	<select id="selectInquiryCount" resultType="int">
		SELECT COUNT(*) FROM customer WHERE cus_id = #{cus_id}
	</select>

	<!-- 회원 페이지 : 닉네임 검색 -->
	<select id="inquirySearch" parameterType="hashmap" resultType="customerDTO">
		SELECT B.* FROM (
			SELECT ROWNUM cus_rn, A.* FROM
				(SELECT * FROM customer ORDER BY cus_num DESC, cus_date ASC)A
			WHERE cus_nick LIKE '%'||#{cus_nick}||'%' )B 
		WHERE cus_rn BETWEEN #{start} and #{end}
	</select>

	<!-- 회원 페이지 : 검색 결과 개수 -->
	<select id="inquirySearchCount" resultType="int">
		SELECT COUNT(*) FROM customer WHERE cus_nick LIKE '%'||#{cus_nick}||'%'
	</select>

	<!-- 회원 페이지 : 문의글 삭제 -->
	<delete id="deleteInquiry">
		DELETE FROM customer WHERE cus_num = #{cus_num}
	</delete>

	<!-- 회원 페이지 : 비밀글 확인 -->
	<select id="contentPwChk" resultType="String">
		SELECT cus_pw FROM customer WHERE cus_num = #{cus_num}
	</select>






</mapper>