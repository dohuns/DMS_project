<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.KG.mybatis.myMapper">

	<!-- 전체 회원 목록 -->
	<select id="selectMemberList" resultType="memberDTO">
		SELECT ROWNUM m_rn, m_id, m_pw, m_name, m_nick, m_birth, m_email, m_rank, m_rankNum
		FROM (SELECT * FROM member ORDER BY m_rankNum, m_birth, m_id)
	</select>

	<!-- 등급별 회원 목록 -->
	<select id="selectRankList" parameterType="hashMap" resultType="memberDTO">
		SELECT B.* FROM (
			SELECT ROWNUM m_rn, A.* FROM
				(SELECT * FROM member ORDER BY m_rankNum, m_birth, m_id)A 
			WHERE m_rankNum = #{m_rankNum} )B
		WHERE m_rn BETWEEN #{start} and #{end}
	</select>

	<!-- 검색한 회원 정보 수 -->
	<select id="getSearchCount" parameterType="hashMap" resultType="int">
		SELECT COUNT(*) FROM member
		WHERE ${searchOption} LIKE '%'||#{keyword}||'%'
	</select>

	<!-- 회원 정보 검색 -->
	<select id="selectSearchList" parameterType="hashMap" resultType="memberDTO">
		SELECT B.* FROM (
			SELECT ROWNUM m_rn, A.* FROM
				(SELECT * FROM member ORDER BY m_rankNum, m_birth, m_id)A 
			WHERE ${searchOption} LIKE '%'||#{keyword}||'%' )B
		WHERE m_rn BETWEEN #{start} and #{end}
	</select>

	<!-- 회원 정보 추가 -->
	<insert id="insertMember" parameterType="memberDTO">
		INSERT INTO member (m_id, m_pw, m_nick, m_name, m_birth, m_email, m_rank, m_rankNum) 
		VALUES (#{m_id}, #{m_pw}, #{m_nick}, #{m_name}, SYSDATE, '[R.M]adminTestID', #{m_rank}, #{m_rankNum})
	</insert>

	<!-- 회원 정보 수정 -->
	<update id="updateMember" parameterType="memberDTO">
		UPDATE member SET m_pw = #{m_pw}, m_nick = #{m_nick}, m_name = #{m_name},
		m_email = #{m_email}, m_birth = #{m_birth}, m_rank = #{m_rank}, m_rankNum = #{m_rankNum} 
		WHERE m_id = #{m_id}
	</update>

	<!-- 회원 등급 변경 -->
	<update id="updateRankMember" parameterType="memberDTO">
		UPDATE member SET m_rankNum = #{m_rankNum}, m_rank = #{m_rank} WHERE m_id = #{m_id}
	</update>

	<!-- 회원 정보 출력 : 수정 -->
	<select id="selectInfoList" resultType="memberDTO">
		SELECT * FROM member WHERE m_id = #{m_id}
	</select>

	<!-- 회원 정보 삭제 -->
	<update id="deleteMember">
		DELETE FROM member WHERE m_id = #{m_id}
	</update>

	<!-- 회원 수 -->
	<select id="getMemberCount" resultType="int">
		SELECT COUNT(*) FROM member
	</select>

	<!-- 등급별 회원 수 -->
	<select id="getRankCount" resultType="int">
		SELECT COUNT(*) FROM member WHERE m_rankNum = #{m_rankNum}
	</select>

</mapper>